{% extends 'base.html' %}
{% load static %}

{% block title %}Rādījumu vēsture - {{ meter.get_meter_type_display }} - Propmty{% endblock %}

{% block content %}
{% include 'partials/navbar.html'%}
<div class="container py-4">
    <div class="mb-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'tenant_portal:dashboard' %}">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{% url 'tenant_portal:meter_readings' %}">Skaitītāju rādījumi</a></li>
                <li class="breadcrumb-item actice" aria-current="page">{{lease.unit.unit_number}} {{ meter.get_meter_type_display }} - {{ meter.meter_number }}</li>
            </ol>
        </nav>
    </div>
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
        <h1 class="h2">Skaitītāja rādījumu vēsture</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
            <div class="btn-group me-2">
                <a href="{% url 'tenant_portal:meter_readings' %}" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Atpakaļ
                </a>
            </div>
        </div>
    </div>
    
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Skaitītāja informācija</h5>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-4">Adrese:</dt>
                        <dd class="col-sm-8">{{ lease.unit.property.address }}</dd>
                        
                        <dt class="col-sm-4">Telpa:</dt>
                        <dd class="col-sm-8">{{ lease.unit.unit_number }}</dd>
                        
                        <dt class="col-sm-4">Skaitītājs:</dt>
                        <dd class="col-sm-8">{{ meter.get_meter_type_display }}</dd>
                        
                        <dt class="col-sm-4">Numurs:</dt>
                        <dd class="col-sm-8">{{ meter.meter_number }}</dd>
                        
                        <dt class="col-sm-4">Statuss:</dt>
                        <dd class="col-sm-8">
                            {% if meter.status == 'active' %}
                            <span class="badge bg-success">Aktīvs</span>
                            {% elif meter.status == 'inactive' %}
                            <span class="badge bg-secondary">Neaktīvs</span>
                            {% elif meter.status == 'expired' %}
                            <span class="badge bg-warning">Beidzies</span>
                            {% endif %}
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Rādījumu kopsavilkums</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3 text-center">
                                <h6 class="text-muted mb-1">Pēdējais rādījums</h6>
                                <h3 class="mb-0">
                                    {% if readings.0 %}
                                        {{ readings.0.reading }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </h3>
                                <small class="text-muted">
                                    {% if readings.0 %}
                                        {{ readings.0.reading_date|date:"d.m.Y" }}
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3 text-center">
                                <h6 class="text-muted mb-1">Pēdējais patēriņš</h6>
                                <h3 class="mb-0">
                                    {% if readings.0 and readings.0.consumption != None %}
                                        {{ readings.0.consumption }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </h3>
                                <small class="text-muted">
                                    {% if readings.0 and readings.1 %}
                                        {{ readings.1.reading_date|date:"d.m.Y" }} - {{ readings.0.reading_date|date:"d.m.Y" }}
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    {% if readings.count > 0 %}
                    <div class="mt-3 text-center">
                        <a href="{% url 'tenant_portal:submit_reading' lease.id meter.id %}" class="btn btn-primary">
                            <i class="bi bi-plus-circle me-2"></i> Iesniegt jaunu rādījumu
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Rādījumu vēsture</h5>
        </div>
        <div class="card-body">
            {% if readings %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Datums</th>
                            <th>Rādījums</th>
                            <th>Patēriņš</th>
                            <th>Statuss</th>
                            <th>Piezīmes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for reading in readings %}
                        <tr>
                            <td>{{ reading.reading_date|date:"d.m.Y" }}</td>
                            <td>{{ reading.reading }}</td>
                            <td>
                                {% if reading.consumption != None %}
                                {{ reading.consumption }}
                                {% else %}
                                -
                                {% endif %}
                            </td>
                            <td>
                                {% if reading.is_verified %}
                                <span class="badge bg-success">Verificēts</span>
                                {% else %}
                                <span class="badge bg-warning">Gaida verifikāciju</span>
                                {% endif %}
                            </td>
                            <td>{{ reading.notes|default:"-"|truncatechars:30 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-4">
                <div class="mb-3">
                    <i class="bi bi-clipboard-data fs-3 text-muted"></i>
                </div>
                <h5>Nav rādījumu</h5>
                <p class="text-muted">Šim skaitītājam vēl nav iesniegti rādījumi.</p>
                
                <a href="{% url 'tenant_portal:submit_reading' lease.id meter.id %}" class="btn btn-primary">
                    <i class="bi bi-plus-circle me-2"></i> Iesniegt pirmo rādījumu
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}